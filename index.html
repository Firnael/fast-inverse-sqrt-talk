<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/ico" href="favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://kit.fontawesome.com/d2d077b940.js" crossorigin="anonymous"></script>
  <title>Fast Inverse Square Root - The Talk</title>
</head>

<body>
  <div class="reveal">
    <div class="slides">

      <!-- 1. Introdution -->
      <!-- Splash -->
      <section data-background-image="/1/splash.jpg" data-transition="fade">
        <h1 class="main-title r-fit-text">The (In)glorious Function</h1>
        <aside class="notes">
          Bonjour √† tous, bienvenue √† tous au MaxCamp 2023, pour ceux qui ne me connaissent pas
          je m'appelle Audren Burlot, et je suis honor√© de d√©marrer la journ√©e avec ce talk
          qui s'intitule "The Inglorious Function".
        </aside>
      </section>
      <section data-background-image="/1/splash.jpg" class="blurred">
        <section>
          L'histoire d'une fonction
          <aside class="notes">
            Aujourd'hui je vais vous raconter l'histoire d'une fonction.
            Une fonction trouv√©e il y a 20 dans le code source d'un jeu sorti il y a 24 ans.
          </aside>
        </section>
        <section>
          <img src="/1/cake-aux-olives.jpeg" />
          <aside class="notes">
            On va parler de Quake 3, de normalisation de vecteurs, de logarithme de base 2, de ce bon vieux Newton,
            et de sorcellerie
          </aside>
        </section>
        <section>
          <img class="r-stretch" src="/1/ah-shit.gif" />
          <aside class="notes">
            Mais avant de vous parler de code, il faut qu'on revienne un peu en arri√®re
          </aside>
        </section>
      </section>

      <!-- 2. Storytime -->
      <section data-background-image="/2/pere-castor.jpeg">
        <h2>2.<br />Storytime</h2>
        <h4>again !</h4>
      </section>
      <section class="blurred" data-background-image="/2/pere-castor.jpeg">
        <section>
          <img class="r-stretch" src="/2/softdisk-offices.jpeg" />
          <aside class="notes">
            Notre histoire commence au d√©but des ann√©es 80, avec une entreprise qui se nomme Softdisk Publishing.
          </aside>
        </section>

        <section>
          <div class="ch">
            <div class="item">
              <img src="/2/softdisk-publishing-logo.webp" />
              <img src="/2/shreveport.jpg" />
              <p>Shreveport - Louisiane</p>
            </div>
            <div class="item">
              <img src="/2/harbinger.webp" />
              <p>1981</p>
            </div>
          </div>
          <aside class="notes">
            D'abord un club un club d'informatique, puis une entreprise en 1981, Softdisk est une boite
            d'√©dition de magazines sur disquette divers et vari√©s √† parution mensuelle.
            A droite le premier diskmag de la boite : The Harbinger, pour Apple II.
          </aside>
        </section>

        <section>
          <img class="r-stretch" src="/2/floppy-disks.jpeg">
          <aside class="notes">
            Un magazine sur disquette, "diskmag" en anglais et m√™me "magazette" en fran√ßais,
            est un magazine souvent amateur distribu√© sous format √©lectronique afin d'√™tre lu sur un ordinateur.
            Ils connurent leur pic de popularit√© dans les ann√©es 1980 et 1990 sous la forme de p√©riodiques distribu√©s
            sur m√©dia amovible (disquette), d'o√π leur nom.
          </aside>
        </section>

        <section>
          <div class="ch">
            <div class="item">
              <img src="/2/loadstar-1.jpeg">
            </div>
            <div class="item">
              <img src="/2/loadstar-2.jpeg" height="500px">
            </div>
          </div>
          <p>1984</p>
          <aside class="notes">
            - La caract√©ristique essentielle d'un diskmag, par distinction d'un magazine ASCII typique,
            est la pr√©sence d'un fichier ex√©cutable destin√© √† tourner sur une plate-forme sp√©cifique.
            - Ici le diskmag LOADSTAR pour Commodore 64 d'Amiga
          </aside>
        </section>

        <section>
          <img class="r-stretch" src="/2/big-blue-disk.jpeg">
          <p>1986</p>
          <aside class="notes">
            Cet ex√©cutable lance un programme qui permet d'acc√©der aux diff√©rents articles.
            Un diskmag tend √† mettre l'accent sur l'esth√©tique et propose une interface graphique d√©di√©e,
            de la musique de fond et d'autres fonctionnalit√©s utilisant la plate-forme pour laquelle il est cod√©.
          </aside>
        </section>

        <section>
          <img class="r-stretch" src="/2/gamers-edge.png">
          <p>1990</p>
          <aside class="notes">
            En 1990, un petit groupe d'employ√©s de Softdisk prend l'initiative de cr√©er un diskmag d√©di√© aux jeux video,
            sous le nom de Gamer's Edge.
          </aside>
        </section>

        <section>
          <img class="r-stretch" src="/2/id-software-team.webp">
          <aside class="notes">
            Ce groupe se d√©signant lui m√™me sous le nom de "Ideas From The Deep" est compos√© de 5 personnes : 
            - John Carmack (programmeur)
            - John Romero (programmeur)
            - Tom Hall (concepteur)
            - Adrian Carmack (artiste, pas du tout de la famille de John)
            - Jay Wilbur, le manager
          </aside>
        </section>

        <section>
          <img class="r-stretch" src="/2/internet-scholastic.jpg">
          <aside class="notes">
            Le d√©veloppement d'Internet √† la fin des ann√©es 1990 a conduit √† leur remplacement presque int√©gral
            par des publications en ligne, certaines se d√©signant toujours comme ¬´ diskmags ¬ª
            malgr√© l'absence de support physique.
          </aside>
        </section>

        <section>
          - de la cr√©ation d'idSoftware,<br />
          - √† la cr√©ation de Quake 3 Arena,<br />
          - √† la lib√©ration du code en open source en 2005.<br />
          - √† la d√©couverte de la fonction Q_rsqrt<br />
          <aside class="notes">
            Notre histoire commence en 1990.
            https://fr.wikipedia.org/wiki/Id_Software
          </aside>
        </section>

        <section>
          ...
        </section>

      </section>

      <!-- 3. Cette fonction, qu'est-ce qu'elle fait ? -->
      <section>
        <section>
          <h2>3.<br />La fonction</h2>
        </section>

        <section data-transition="fade">
          <div class="big">
            \[f(x) = \frac{1}{\sqrt{x}}\]
          </div>
          <aside class="notes">
            Cette fonction, elle ne fait qu'une seule chose : elle calcule l'inverse de la racine carr√©e d'un nombre.
          </aside>
        </section>

        <section>
          <div style="margin-left: 15%;" class="big">
            <pre class="c clean">
              <code class="fragment" data-trim>
                <script type="text/template">
                  #include <math.h>
                </script>
              </code>
              <code data-trim>
                float y = 1 / sqrt(x);
              </code>
            </pre>
          </div>
          <aside class="notes">
            En C on l'√©crirait comme ceci.

            On aurait pas besoin de coder une fonction de calcul de racine carr√©e,
            on la chopperait dans une lib standard, comme math.h.
          </aside>
        </section>

        <section data-transition="fade">
          <br />
          <div class="cv">
            <div class="item fragment">
              <pre class="c wide smaller clean">
                <code data-trim>
                  float Q_rsqrt( float number ) {
                    long i;
                    float x2, y;
                    const float threehalfs = 1.5F;
  
                    x2 = number * 0.5F;
                    y  = number;
                    i  = * ( long * ) &y;                        // evil floating point bit level hacking
                    i  = 0x5f3759df - ( i >> 1 );                // what the fuck?
                    y  = * ( float * ) &i;
                    y  = y * ( threehalfs - ( x2 * y * y ) );    // 1st iteration
                    // y  = y * ( threehalfs - ( x2 * y * y ) ); // 2nd iteration, this can be removed
  
                    return y;
                  }
                </code>
              </pre>
            </div>
            <div class="item fragment">
              <img class="above-right" src="/3/the-what.jpeg" />
            </div>
          </div>
          <aside class="notes">
            Mais dans le code source Quake, on ne retrouve pas cette fonction.
            Voici ce qu'on y trouve √† la place.
          </aside>
        </section>

        <section data-transition="zoom">
          <code data-id="Q" class="title">Q</code>
          <code data-id="_" class="title">_</code>
          <code data-id="r" class="title">r</code>
          <code data-id="sqrt" class="title">sqrt</code>
          <br />
          <code class="bright">
            <span class="fragment">Quake</span>
            <span class="fragment">Reverse</span>
            <span class="fragment">Square Root</span>
          </code>
          <br />
          <div class="fragment">
            <br />
            <i>The Fast Inverse Square Root Algorithm</i>
          </div>
          <aside class="notes">
            Ou "Fast Inverse Square Root Algorithm"
          </aside>
        </section>

      </section>

      <!-- 4. Normaliser des vecteurs -->
      <section>
        <section>
          <h2>4.<br />Normal mon gars</h2>
          <img src="/4/pretend-to-be-normal.png" />
          <aside class="notes">
            Tout √ßa c'est bien, mais pourquoi diable aurait-on besoin de calculer l'inverse de la racine carr√©e
            d'un nombre ?
            Et bien tout simplement pour normaliser des vecteurs.
          </aside>
        </section>

        <section>
          <h3>Illustration par l'exemple</h3>
          <h4>une belle brochette de vainqueurs</h4>
          <div class="ch">
            <div class="item"><img src="/4/tetes/alexo.png" /></div>
            <div class="item"><img src="/4/tetes/erwann.png" /></div>
            <div class="item"><img src="/4/tetes/fdu.png" /></div>
            <div class="item"><img src="/4/tetes/greg.png" /></div>
            <div class="item"><img src="/4/tetes/jeremie.png" /></div>
            <div class="item"><img src="/4/tetes/lasouche.png" /></div>
          </div>
        </section>

        <section>
          <div class="cube" id="three-animation"></div>
        </section>

        <section>
          <img src="/4/jerem-applati.png" />
          <aside class="notes">
            !!! BESOIN DU STYLET !!!
            comment √ßa marche ? Pour calculer l'angle de la lumi√®re, on a besoin d'une ligne perpendiculaire √† J√©r√©mie.
            J√©r√©mie est un plan (un bon plan), on cherche ce qu'on appelle le vecteur "normal" au plan.
          </aside>
        </section>

        <section>
          Trouver un vecteur normal √† un plan, c'est pas compliqu√©.
          <br />
          Normaliser ce vecteur, c'est pas compliqu√© non plus, mais √ßa co√ªte plus cher.
          <br />
          En effet, on a une division, et une racine carr√©e l√† dedans.
        </section>

        <section>
          <div class="game" id="game-container"></div>
        </section>

      </section>

      <!-- 5. Le d√©but de la fonction, et l'IEEE 754 -->
      <section>

        <section>
          <h2>5.<br />C'est parti pour se PETER le cr√¢ne</h2>
        </section>

        <section>
          On va d√©crire le code de la fonction ligne par ligne.
        </section>

        <section data-auto-animate>
          <div class="cv">
            <div class="item">
              <pre data-id="1" class="c wide smaller clean">
                <code data-trim data-line-numbers="1-4">
                  float Q_rsqrt( float number ) {
                    long i;
                    float x2, y;
                    const float threehalfs = 1.5F;
  
                    x2 = number * 0.5F;
                    y  = number;
                    i  = * ( long * ) &y;                        // evil floating point bit level hacking
                    i  = 0x5f3759df - ( i >> 1 );                // what the fuck?
                    y  = * ( float * ) &i;
                    y  = y * ( threehalfs - ( x2 * y * y ) );    // 1st iteration
                    // y  = y * ( threehalfs - ( x2 * y * y ) ); // 2nd iteration, this can be removed
  
                    return y;
                  }
                </code>
              </pre>
            </div>
          </div>
        </section>

        <section data-auto-animate>
          <pre data-id="1" class="c smaller clean">
            <code data-trim data-line-numbers>
              float Q_rsqrt( float number ) {
                long i;
                float x2, y;
                const float threehalfs = 1.5F;
            </code>
          </pre>
          <div class="cv">
            <div class="item">
              <div class="fragment fade-in-then-semi-out">
                <code class="normal bold">number</code>, un <code class="type bold">float</code> dont on veut
                <br />la racine carr√©e invers√©e
              </div>
              <div class="fragment fade-in-then-semi-out">
                <code class="normal bold">i</code>, un <code class="type bold">long</code> sur <strong>32 bits</strong>
              </div>
              <div class="fragment fade-in-then-semi-out	">
                <code class="normal bold">x2</code> et <code class="normal bold">y</code>,
                deux <code class="type bold">float</code>, aussi sur <strong>32 bits</strong>
              </div>
              <div class="fragment">
                <code class="normal bold">threehalfs</code>, un <code class="type bold">const float</code>
                sur <strong>32 bits</strong>,
                <br />initialis√© √† <strong>1,5</strong>
              </div>
            </div>
          </div>
          <aside class="notes">
            Commen√ßons par lire ces quelques lignes qui, j'en suis s√ªr, ne pr√©sentent pas particuli√®rement de
            difficult√©...
            Enfin √ßa c'est pas si simple :p

            D√©j√† quelques questions √©mergent :
            - Pourquoi on d√©clare une constante pour 1,5 ?
            - Pourquoi threehalfs et pas threehalves, qui est l'orthographe correcte ?
            - Aucune id√©e ü§°
          </aside>
        </section>

        <!-- integer -->
        <section>
          <h3>long</h3>
          <h4><code class="normal">long32</code></h4>
          <br />
          <div class="r-stack">
            <code class="fragment fade-out instant bright"
              data-fragment-index="2">00000000 00000000 00000000 00000000</code>
            <code class="fragment current-visible instant bright"
              data-fragment-index="2">00000000 00000000 00000000 00000001</code>
            <code class="fragment current-visible instant bright"
              data-fragment-index="3">00000000 00000000 00000000 00000010</code>
            <code class="fragment current-visible instant bright"
              data-fragment-index="4">00000000 00000000 00000000 00000011</code>
            <code class="fragment current-visible instant bright"
              data-fragment-index="5">00000000 00000000 00000000 00000100</code>
            <code class="fragment instant bright" data-fragment-index="6">01111111 11111111 11111111 11111111</code>
          </div>
          <br />
          <div class="r-stack">
            <code class="fragment current-visible instant normal" data-fragment-index="1">0</code>
            <code class="fragment current-visible instant normal" data-fragment-index="2">1</code>
            <code class="fragment current-visible instant normal" data-fragment-index="3">2</code>
            <code class="fragment current-visible instant normal" data-fragment-index="4">3</code>
            <code class="fragment current-visible instant normal" data-fragment-index="5">4</code>
            <code class="fragment instant normal" data-fragment-index="6">2147483647</code>
          </div>
          <aside class="notes">
            Un long repr√©sente un entier (positif ou n√©gatif) sur 32 bits.
            Il peut donc prendre 2^32 valeurs diff√©rentes, de -2^31 √† 2^31-1.
            le premier bit est le signe, et les 31 autres bits repr√©sentent la valeur.

            D'ailleurs, si vous voulez un moyen mn√©motechnique simple pour vous souvenir de cette valeur,
            il vous suffit de m√©moriser le nombre PI jusqu'√† sa 1,867,996,689√®me d√©cimale :)

            The numeric string 2147483647 appears at the 1,867,996,680 decimal digit of Pi.
            3.14......86181221809936452346 2147483647 10527835665425671614...
          </aside>
        </section>

        <!-- float -->
        <section data-auto-animate>
          <h3>float</h3>
          <h4><code class="normal">float32</code></h4>
          <br />
          <div class="r-stack">
            <code class="fragment fade-out instant bright"
              data-fragment-index="2">00000000 00000000 00000000 00000000</code>
            <code class="fragment current-visible instant bright"
              data-fragment-index="2">00000000 00000000.00000000 00000000</code>
            <code class="fragment current-visible instant bright"
              data-fragment-index="3">00000000 00000001.00000000 00000000</code>
            <code class="fragment current-visible instant bright"
              data-fragment-index="4">00000000 00000010.00000000 00000000</code>
            <code class="fragment current-visible instant bright"
              data-fragment-index="5">00000000 00000011.00000000 00000000</code>
            <code class="fragment current-visible instant bright"
              data-fragment-index="6">00000000 00000100.00000000 00000000</code>
            <code class="fragment current-visible instant bright"
              data-fragment-index="7">00000000 00000100.10000000 00000000</code>
            <code class="fragment current-visible instant bright"
              data-fragment-index="8">00000000 00000100.01000000 00000000</code>
            <code class="fragment current-visible instant bright"
              data-fragment-index="9">00000000 00000100.00100000 00000000</code>
            <code class="fragment current-visible instant bright"
              data-fragment-index="10">00000000 00000100.00010000 00000000</code>
            <code class="fragment instant bright" data-fragment-index="11">11111111 11111111.00010000 00000000</code>
          </div>
          <br />
          <div class="r-stack">
            <code class="fragment current-visible instant normal" data-fragment-index="2">0</code>
            <code class="fragment current-visible instant normal" data-fragment-index="3">1</code>
            <code class="fragment current-visible instant normal" data-fragment-index="4">2</code>
            <code class="fragment current-visible instant normal" data-fragment-index="5">3</code>
            <code class="fragment current-visible instant normal" data-fragment-index="6">4</code>
            <code class="fragment current-visible instant normal" data-fragment-index="7">4.5</code>
            <code class="fragment current-visible instant normal" data-fragment-index="8">4.25</code>
            <code class="fragment current-visible instant normal" data-fragment-index="9">4.125</code>
            <code class="fragment current-visible instant normal" data-fragment-index="10">4.0625</code>
            <code class="fragment instant normal" data-fragment-index="11">65536.0625</code>
          </div>
          <img class="fragment current-visible top-right" src="/5/this-is-the-worst.gif" data-fragment-index="12" />
          <aside class="notes">
            Un float repr√©sente un nombre d√©cimal, ou "nombre √† virgule flottante" sur 32 bits.
            On va revenir sur ce terme.

            Question √† l'assembl√©e : comment vous repr√©senteriez un tel nombre, si vous aviez ces 32 bits ?
            -> Oui, on peut mettre un point au milieu, et s√©parer les bits en deux parties.
            La partie gauche pour la partie enti√®re, et la partie droite pour la partie d√©cimale.

            On aurait donc la partie gauche qui sont des puissance de 2, et la partie droite qui sont des puissance de 2
            n√©gatives : des demi, quart, huiti√®me, 16√®me, etc.

            Mais on a un probl√®me : en faisant cela, on r√©duit drastiquement le maximum repr√©sentable !
            On ne peut peut plus stoquer que des nombres compris entre
            -2^16 et 2^16-1, soit 65536 valeurs diff√©rentes.

            Ce qui est tr√®s cringe !
          </aside>
        </section>

        <section>
          <br />
          <h3>Du coup, comment on fait ?</h3>
          <br />
          <div class="ch">
            <div class="item fragment">
              On double la taille d'un <code class="type bold">float</code> ?
              <br />
              <code class="normal bold">float32 -> float64</code>
            </div>
            <div class="item fragment">
              Mais en fait <code class="normal bold">float64</code> √ßa existe d√©j√†,
              <br />
              c'est un <code class="normal bold">double</code> üòÖ
            </div>
          </div>
          <br />
          <div class="ch">
            <div class="item fragment">
              Donc on cr√©er un nouveau <code class="normal bold">float128</code> ?
            </div>
            <div class="item fragment">
              √áa commence √† prendre beaucoup de place en m√©moire...
            </div>
          </div>
          <aside class="notes">
            On est d'accord que ce n'est pas acceptable.
            On pourrait augmenter la taille de notre float, mais √ßa cr√©er d'autres probl√®mes :
            - √ßa prend plus de place en m√©moire, le moindre float genre "3.2" prend 64 bits au lieu de 32, le double de
            place,
            - il aurait fallut cr√©er un float128 pour stocker des nombres √† plus grande pr√©cision (ce que sont les
            double),
            ce qui aurait pos√© des probl√®mes d'architectures des processeurs, qui sont con√ßu pour manipuler des nombres
            sur 32 ou 64 bits.
          </aside>
        </section>

        <section>
          <video class="r-stretch" data-autoplay src="/5/homer-cest-nul.webm"></video>
        </section>

        <section>
          <h4>Heureusement il y a la ...</h4>
          <h1>IEEE 754</h1>
          <aside class="notes">
            C'est ce que se sont dit des gens pour √ßa que des gens plut√¥t malins, des gens de l'IEEE
          </aside>
        </section>

      </section>

      <!-- 6. Log2(1+x) -->
      <section>
        <section>
          <h2>6.<br />\[\log_2(1+x)\]</h2>
        </section>
        <section>
          √Ä ce stade du talk, laissez moi attirer votre attention sur un point important.
        </section>
      </section>

      <!-- 7. Filouteries logarithmiques -->
      <section>
        <section>
          <h2>7.<br />Filouteries logarithmiques</h2>
        </section>
      </section>

      <!-- 8. Le langage C en sueur -->
      <section>
        <section>
          <h2>8.<br />Le langage C en sueur</h2>
        </section>
      </section>

      <!-- 9. What the fuck -->
      <section>
        <section>
          <h2>9.<br />What the fuck</h2>
        </section>
      </section>

      <!-- 10. Ce bon vieux Newton -->
      <section>
        <section>
          <h2>10.<br />Ce bon vieux Newton</h2>
        </section>
      </section>

      <!-- 11. Conclusion -->
      <section>
        <section>
          <h2>11.<br />Conclusion</h2>
        </section>
        <section>
          Qu'est ce qu'on a appris
        </section>
      </section>

      <!-- 12. Fin -->
      <section>
        <section>
          <h1>Merci !</h1>
          Distribution de parac√©tamol √† la pause
        </section>
      </section>
    </div> <!-- /slides -->
  </div> <!-- /reveal -->

  <!-- Scripts -->
  <script type="module" src="/phaser.js"></script>
  <script type="module" src="/three.js"></script>
  <script type="module" src="/main.js"></script>
</body>

</html>